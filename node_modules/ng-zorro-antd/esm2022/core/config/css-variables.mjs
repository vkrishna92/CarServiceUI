/**
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE
 */
/**
 * Sync from @ant-design/colors(https://github.com/ant-design/ant-design-colors)
 */
import { TinyColor } from '@ctrl/tinycolor';
import { generate } from 'ng-zorro-antd/core/color';
import { warn } from 'ng-zorro-antd/core/logger';
import { canUseDom, updateCSS } from 'ng-zorro-antd/core/util';
const dynamicStyleMark = `-ant-${Date.now()}-${Math.random()}`;
export function getStyle(globalPrefixCls, theme) {
    const variables = {};
    const formatColor = (color, updater) => {
        let clone = color.clone();
        clone = updater?.(clone) || clone;
        return clone.toRgbString();
    };
    const fillColor = (colorVal, type) => {
        const baseColor = new TinyColor(colorVal);
        const colorPalettes = generate(baseColor.toRgbString());
        variables[`${type}-color`] = formatColor(baseColor);
        variables[`${type}-color-disabled`] = colorPalettes[1];
        variables[`${type}-color-hover`] = colorPalettes[4];
        variables[`${type}-color-active`] = colorPalettes[7];
        variables[`${type}-color-outline`] = baseColor.clone().setAlpha(0.2).toRgbString();
        variables[`${type}-color-deprecated-bg`] = colorPalettes[1];
        variables[`${type}-color-deprecated-border`] = colorPalettes[3];
    };
    // ================ Primary Color ================
    if (theme.primaryColor) {
        fillColor(theme.primaryColor, 'primary');
        const primaryColor = new TinyColor(theme.primaryColor);
        const primaryColors = generate(primaryColor.toRgbString());
        // Legacy - We should use semantic naming standard
        primaryColors.forEach((color, index) => {
            variables[`primary-${index + 1}`] = color;
        });
        // Deprecated
        variables['primary-color-deprecated-l-35'] = formatColor(primaryColor, c => c.lighten(35));
        variables['primary-color-deprecated-l-20'] = formatColor(primaryColor, c => c.lighten(20));
        variables['primary-color-deprecated-t-20'] = formatColor(primaryColor, c => c.tint(20));
        variables['primary-color-deprecated-t-50'] = formatColor(primaryColor, c => c.tint(50));
        variables['primary-color-deprecated-f-12'] = formatColor(primaryColor, c => c.setAlpha(c.getAlpha() * 0.12));
        const primaryActiveColor = new TinyColor(primaryColors[0]);
        variables['primary-color-active-deprecated-f-30'] = formatColor(primaryActiveColor, c => c.setAlpha(c.getAlpha() * 0.3));
        variables['primary-color-active-deprecated-d-02'] = formatColor(primaryActiveColor, c => c.darken(2));
    }
    // ================ Success Color ================
    if (theme.successColor) {
        fillColor(theme.successColor, 'success');
    }
    // ================ Warning Color ================
    if (theme.warningColor) {
        fillColor(theme.warningColor, 'warning');
    }
    // ================= Error Color =================
    if (theme.errorColor) {
        fillColor(theme.errorColor, 'error');
    }
    // ================= Info Color ==================
    if (theme.infoColor) {
        fillColor(theme.infoColor, 'info');
    }
    // Convert to css variables
    const cssList = Object.keys(variables).map(key => `--${globalPrefixCls}-${key}: ${variables[key]};`);
    return `
  :root {
    ${cssList.join('\n')}
  }
  `.trim();
}
export function registerTheme(globalPrefixCls, theme, cspNonce) {
    const style = getStyle(globalPrefixCls, theme);
    if (canUseDom()) {
        updateCSS(style, `${dynamicStyleMark}-dynamic-theme`, { cspNonce });
    }
    else {
        warn(`NzConfigService: SSR do not support dynamic theme with css variables.`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3NzLXZhcmlhYmxlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvY29yZS9jb25maWcvY3NzLXZhcmlhYmxlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFFSDs7R0FFRztBQUNILE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUU1QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDcEQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFJL0QsTUFBTSxnQkFBZ0IsR0FBRyxRQUFRLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQztBQUUvRCxNQUFNLFVBQVUsUUFBUSxDQUFDLGVBQXVCLEVBQUUsS0FBWTtJQUM1RCxNQUFNLFNBQVMsR0FBMkIsRUFBRSxDQUFDO0lBRTdDLE1BQU0sV0FBVyxHQUFHLENBQUMsS0FBZ0IsRUFBRSxPQUEwRCxFQUFVLEVBQUU7UUFDM0csSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzFCLEtBQUssR0FBRyxPQUFPLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLENBQUM7UUFDbEMsT0FBTyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDN0IsQ0FBQyxDQUFDO0lBRUYsTUFBTSxTQUFTLEdBQUcsQ0FBQyxRQUFnQixFQUFFLElBQVksRUFBUSxFQUFFO1FBQ3pELE1BQU0sU0FBUyxHQUFHLElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sYUFBYSxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztRQUV4RCxTQUFTLENBQUMsR0FBRyxJQUFJ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LENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9ORy1aT1JSTy9uZy16b3Jyby1hbnRkL2Jsb2IvbWFzdGVyL0xJQ0VOU0VcbiAqL1xuXG4vKipcbiAqIFN5bmMgZnJvbSBAYW50LWRlc2lnbi9jb2xvcnMoaHR0cHM6Ly9naXRodWIuY29tL2FudC1kZXNpZ24vYW50LWRlc2lnbi1jb2xvcnMpXG4gKi9cbmltcG9ydCB7IFRpbnlDb2xvciB9IGZyb20gJ0BjdHJsL3Rpbnljb2xvcic7XG5cbmltcG9ydCB7IGdlbmVyYXRlIH0gZnJvbSAnbmctem9ycm8tYW50ZC9jb3JlL2NvbG9yJztcbmltcG9ydCB7IHdhcm4gfSBmcm9tICduZy16b3Jyby1hbnRkL2NvcmUvbG9nZ2VyJztcbmltcG9ydCB7IGNhblVzZURvbSwgdXBkYXRlQ1NTIH0gZnJvbSAnbmctem9ycm8tYW50ZC9jb3JlL3V0aWwnO1xuXG5pbXBvcnQgeyBUaGVtZSB9IGZyb20gJy4vY29uZmlnJztcblxuY29uc3QgZHluYW1pY1N0eWxlTWFyayA9IGAtYW50LSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpfWA7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTdHlsZShnbG9iYWxQcmVmaXhDbHM6IHN0cmluZywgdGhlbWU6IFRoZW1lKTogc3RyaW5nIHtcbiAgY29uc3QgdmFyaWFibGVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG5cbiAgY29uc3QgZm9ybWF0Q29sb3IgPSAoY29sb3I6IFRpbnlDb2xvciwgdXBkYXRlcj86IChjbG9uZUNvbG9yOiBUaW55Q29sb3IpID0+IFRpbnlDb2xvciB8IHVuZGVmaW5lZCk6IHN0cmluZyA9PiB7XG4gICAgbGV0IGNsb25lID0gY29sb3IuY2xvbmUoKTtcbiAgICBjbG9uZSA9IHVwZGF0ZXI/LihjbG9uZSkgfHwgY2xvbmU7XG4gICAgcmV0dXJuIGNsb25lLnRvUmdiU3RyaW5nKCk7XG4gIH07XG5cbiAgY29uc3QgZmlsbENvbG9yID0gKGNvbG9yVmFsOiBzdHJpbmcsIHR5cGU6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IGJhc2VDb2xvciA9IG5ldyBUaW55Q29sb3IoY29sb3JWYWwpO1xuICAgIGNvbnN0IGNvbG9yUGFsZXR0ZXMgPSBnZW5lcmF0ZShiYXNlQ29sb3IudG9SZ2JTdHJpbmcoKSk7XG5cbiAgICB2YXJpYWJsZXNbYCR7dHlwZX0tY29sb3JgXSA9IGZvcm1hdENvbG9yKGJhc2VDb2xvcik7XG4gICAgdmFyaWFibGVzW2Ake3R5cGV9LWNvbG9yLWRpc2FibGVkYF0gPSBjb2xvclBhbGV0dGVzWzFdO1xuICAgIHZhcmlhYmxlc1tgJHt0eXBlfS1jb2xvci1ob3ZlcmBdID0gY29sb3JQYWxldHRlc1s0XTtcbiAgICB2YXJpYWJsZXNbYCR7dHlwZX0tY29sb3ItYWN0aXZlYF0gPSBjb2xvclBhbGV0dGVzWzddO1xuICAgIHZhcmlhYmxlc1tgJHt0eXBlfS1jb2xvci1vdXRsaW5lYF0gPSBiYXNlQ29sb3IuY2xvbmUoKS5zZXRBbHBoYSgwLjIpLnRvUmdiU3RyaW5nKCk7XG4gICAgdmFyaWFibGVzW2Ake3R5cGV9LWNvbG9yLWRlcHJlY2F0ZWQtYmdgXSA9IGNvbG9yUGFsZXR0ZXNbMV07XG4gICAgdmFyaWFibGVzW2Ake3R5cGV9LWNvbG9yLWRlcHJlY2F0ZWQtYm9yZGVyYF0gPSBjb2xvclBhbGV0dGVzWzNdO1xuICB9O1xuXG4gIC8vID09PT09PT09PT09PT09PT0gUHJpbWFyeSBDb2xvciA9PT09PT09PT09PT09PT09XG4gIGlmICh0aGVtZS5wcmltYXJ5Q29sb3IpIHtcbiAgICBmaWxsQ29sb3IodGhlbWUucHJpbWFyeUNvbG9yLCAncHJpbWFyeScpO1xuXG4gICAgY29uc3QgcHJpbWFyeUNvbG9yID0gbmV3IFRpbnlDb2xvcih0aGVtZS5wcmltYXJ5Q29sb3IpO1xuICAgIGNvbnN0IHByaW1hcnlDb2xvcnMgPSBnZW5lcmF0ZShwcmltYXJ5Q29sb3IudG9SZ2JTdHJpbmcoKSk7XG5cbiAgICAvLyBMZWdhY3kgLSBXZSBzaG91bGQgdXNlIHNlbWFudGljIG5hbWluZyBzdGFuZGFyZFxuICAgIHByaW1hcnlDb2xvcnMuZm9yRWFjaCgoY29sb3IsIGluZGV4KSA9PiB7XG4gICAgICB2YXJpYWJsZXNbYHByaW1hcnktJHtpbmRleCArIDF9YF0gPSBjb2xvcjtcbiAgICB9KTtcbiAgICAvLyBEZXByZWNhdGVkXG4gICAgdmFyaWFibGVzWydwcmltYXJ5LWNvbG9yLWRlcHJlY2F0ZWQtbC0zNSddID0gZm9ybWF0Q29sb3IocHJpbWFyeUNvbG9yLCBjID0+IGMubGlnaHRlbigzNSkpO1xuICAgIHZhcmlhYmxlc1sncHJpbWFyeS1jb2xvci1kZXByZWNhdGVkLWwtMjAnXSA9IGZvcm1hdENvbG9yKHByaW1hcnlDb2xvciwgYyA9PiBjLmxpZ2h0ZW4oMjApKTtcbiAgICB2YXJpYWJsZXNbJ3ByaW1hcnktY29sb3ItZGVwcmVjYXRlZC10LTIwJ10gPSBmb3JtYXRDb2xvcihwcmltYXJ5Q29sb3IsIGMgPT4gYy50aW50KDIwKSk7XG4gICAgdmFyaWFibGVzWydwcmltYXJ5LWNvbG9yLWRlcHJlY2F0ZWQtdC01MCddID0gZm9ybWF0Q29sb3IocHJpbWFyeUNvbG9yLCBjID0+IGMudGludCg1MCkpO1xuICAgIHZhcmlhYmxlc1sncHJpbWFyeS1jb2xvci1kZXByZWNhdGVkLWYtMTInXSA9IGZvcm1hdENvbG9yKHByaW1hcnlDb2xvciwgYyA9PiBjLnNldEFscGhhKGMuZ2V0QWxwaGEoKSAqIDAuMTIpKTtcblxuICAgIGNvbnN0IHByaW1hcnlBY3RpdmVDb2xvciA9IG5ldyBUaW55Q29sb3IocHJpbWFyeUNvbG9yc1swXSk7XG4gICAgdmFyaWFibGVzWydwcmltYXJ5LWNvbG9yLWFjdGl2ZS1kZXByZWNhdGVkLWYtMzAnXSA9IGZvcm1hdENvbG9yKHByaW1hcnlBY3RpdmVDb2xvciwgYyA9PlxuICAgICAgYy5zZXRBbHBoYShjLmdldEFscGhhKCkgKiAwLjMpXG4gICAgKTtcbiAgICB2YXJpYWJsZXNbJ3ByaW1hcnktY29sb3ItYWN0aXZlLWRlcHJlY2F0ZWQtZC0wMiddID0gZm9ybWF0Q29sb3IocHJpbWFyeUFjdGl2ZUNvbG9yLCBjID0+IGMuZGFya2VuKDIpKTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT0gU3VjY2VzcyBDb2xvciA9PT09PT09PT09PT09PT09XG4gIGlmICh0aGVtZS5zdWNjZXNzQ29sb3IpIHtcbiAgICBmaWxsQ29sb3IodGhlbWUuc3VjY2Vzc0NvbG9yLCAnc3VjY2VzcycpO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PSBXYXJuaW5nIENvbG9yID09PT09PT09PT09PT09PT1cbiAgaWYgKHRoZW1lLndhcm5pbmdDb2xvcikge1xuICAgIGZpbGxDb2xvcih0aGVtZS53YXJuaW5nQ29sb3IsICd3YXJuaW5nJyk7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PSBFcnJvciBDb2xvciA9PT09PT09PT09PT09PT09PVxuICBpZiAodGhlbWUuZXJyb3JDb2xvcikge1xuICAgIGZpbGxDb2xvcih0aGVtZS5lcnJvckNvbG9yLCAnZXJyb3InKTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09IEluZm8gQ29sb3IgPT09PT09PT09PT09PT09PT09XG4gIGlmICh0aGVtZS5pbmZvQ29sb3IpIHtcbiAgICBmaWxsQ29sb3IodGhlbWUuaW5mb0NvbG9yLCAnaW5mbycpO1xuICB9XG5cbiAgLy8gQ29udmVydCB0byBjc3MgdmFyaWFibGVzXG4gIGNvbnN0IGNzc0xpc3QgPSBPYmplY3Qua2V5cyh2YXJpYWJsZXMpLm1hcChrZXkgPT4gYC0tJHtnbG9iYWxQcmVmaXhDbHN9LSR7a2V5fTogJHt2YXJpYWJsZXNba2V5XX07YCk7XG5cbiAgcmV0dXJuIGBcbiAgOnJvb3Qge1xuICAgICR7Y3NzTGlzdC5qb2luKCdcXG4nKX1cbiAgfVxuICBgLnRyaW0oKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyVGhlbWUoZ2xvYmFsUHJlZml4Q2xzOiBzdHJpbmcsIHRoZW1lOiBUaGVtZSwgY3NwTm9uY2U6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgY29uc3Qgc3R5bGUgPSBnZXRTdHlsZShnbG9iYWxQcmVmaXhDbHMsIHRoZW1lKTtcblxuICBpZiAoY2FuVXNlRG9tKCkpIHtcbiAgICB1cGRhdGVDU1Moc3R5bGUsIGAke2R5bmFtaWNTdHlsZU1hcmt9LWR5bmFtaWMtdGhlbWVgLCB7IGNzcE5vbmNlIH0pO1xuICB9IGVsc2Uge1xuICAgIHdhcm4oYE56Q29uZmlnU2VydmljZTogU1NSIGRvIG5vdCBzdXBwb3J0IGR5bmFtaWMgdGhlbWUgd2l0aCBjc3MgdmFyaWFibGVzLmApO1xuICB9XG59XG4iXX0=